<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Êâ´Èõ∑Ê∏∏Êàè</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }
        
        .container {
            background: white;
            border-radius: 20px;
            padding: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            max-width: 95vw;
            width: 100%;
        }
        
        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 15px;
            font-size: 2em;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
        }
        
        .difficulty-selector {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        
        .difficulty-btn {
            padding: 8px 16px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            transition: all 0.3s;
            background: #f0f0f0;
            color: #333;
        }
        
        .difficulty-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }
        
        .difficulty-btn.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .difficulty-btn.beginner {
            background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%);
            color: white;
        }
        
        .difficulty-btn.intermediate {
            background: linear-gradient(135deg, #f7971e 0%, #ffd200 100%);
            color: #333;
        }
        
        .difficulty-btn.advanced {
            background: linear-gradient(135deg, #cb2d3e 0%, #ef473a 100%);
            color: white;
        }
        
        .stats {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 15px;
            font-size: 16px;
            flex-wrap: wrap;
        }
        
        .stat-box {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 10px 20px;
            border-radius: 10px;
            text-align: center;
            min-width: 80px;
        }
        
        .stat-label {
            font-size: 11px;
            opacity: 0.8;
            margin-bottom: 3px;
        }
        
        .stat-value {
            font-size: 20px;
            font-weight: bold;
        }
        
        .board {
            display: grid;
            gap: 2px;
            background: #333;
            padding: 10px;
            border-radius: 10px;
            margin-bottom: 20px;
            justify-content: center;
            overflow: auto;
            max-width: 100%;
            max-height: 60vh;
        }
        
        .cell {
            width: 28px;
            height: 28px;
            min-width: 28px;
            min-height: 28px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            font-weight: bold;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: all 0.2s;
            padding: 0;
            -webkit-tap-highlight-color: transparent;
            touch-action: manipulation;
        }
        
        .cell:active {
            transform: scale(0.95);
        }
        
        @media (max-width: 600px) {
            .container {
                padding: 15px;
            }
            
            h1 {
                font-size: 1.6em;
            }
            
            .difficulty-btn {
                padding: 6px 12px;
                font-size: 12px;
            }
            
            .cell {
                width: 22px;
                height: 22px;
                min-width: 22px;
                min-height: 22px;
                font-size: 9px;
            }
            
            .stats {
                gap: 10px;
            }
            
            .stat-box {
                padding: 8px 15px;
                min-width: 70px;
            }
            
            .stat-value {
                font-size: 16px;
            }
            
            .btn {
                padding: 10px 20px;
                font-size: 14px;
            }
        }
        
        @media (max-width: 400px) {
            .cell {
                width: 18px;
                height: 18px;
                min-width: 18px;
                min-height: 18px;
                font-size: 8px;
            }
            
            h1 {
                font-size: 1.3em;
            }
            
            .difficulty-btn {
                padding: 5px 10px;
                font-size: 11px;
            }
        }
        
        .cell:hover:not(.revealed) {
            transform: scale(1.1);
            box-shadow: 0 3px 10px rgba(0, 0, 0, 0.3);
        }
        
        .cell.revealed {
            background: #e0e0e0;
            cursor: default;
        }
        
        .cell.mine {
            background: #ff4444 !important;
        }
        
        .cell.flagged {
            background: #ffa500 !important;
        }
        
        .cell[data-num="1"] { color: #0000ff; }
        .cell[data-num="2"] { color: #008000; }
        .cell[data-num="3"] { color: #ff0000; }
        .cell[data-num="4"] { color: #000080; }
        .cell[data-num="5"] { color: #800000; }
        .cell[data-num="6"] { color: #008080; }
        .cell[data-num="7"] { color: #000000; }
        .cell[data-num="8"] { color: #808080; }
        
        .buttons {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }
        
        .btn {
            padding: 10px 25px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-size: 15px;
            font-weight: bold;
            transition: all 0.3s;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .btn-secondary {
            background: #f0f0f0;
            color: #333;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }
        
        .leaderboard {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 15px;
        }
        
        .leaderboard h2 {
            text-align: center;
            margin-bottom: 10px;
            color: #333;
            font-size: 1.3em;
        }
        
        .leaderboard h3 {
            text-align: center;
            margin-bottom: 10px;
            color: #667eea;
            font-size: 1em;
        }
        
        .leaderboard-list {
            list-style: none;
            max-height: 200px;
            overflow-y: auto;
        }
        
        .leaderboard-item {
            display: flex;
            justify-content: space-between;
            padding: 8px;
            background: white;
            margin-bottom: 4px;
            border-radius: 5px;
            font-size: 14px;
        }
        
        .leaderboard-item:hover {
            transform: translateX(5px);
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        
        .leaderboard-item.gold {
            background: linear-gradient(135deg, #ffd700 0%, #ffec8b 100%);
        }
        
        .leaderboard-item.silver {
            background: linear-gradient(135deg, #c0c0c0 0%, #e8e8e8 100%);
        }
        
        .leaderboard-item.bronze {
            background: linear-gradient(135deg, #cd7f32 0%, #daa06d 100%);
        }
        
        .leaderboard-rank {
            font-weight: bold;
            margin-right: 10px;
            color: #667eea;
        }
        
        .leaderboard-time {
            color: #666;
        }
        
        .leaderboard-empty {
            text-align: center;
            color: #666;
            padding: 20px;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }
        
        .modal.active {
            display: flex;
        }
        
        .modal-content {
            background: white;
            padding: 20px;
            border-radius: 20px;
            text-align: center;
            max-width: 90%;
            width: 350px;
        }
        
        .winner-icon {
            font-size: 50px;
            margin-bottom: 15px;
        }
        
        .modal h2 {
            margin-bottom: 15px;
            color: #333;
            font-size: 1.5em;
        }
        
        .modal h2 {
            margin-bottom: 20px;
            color: #333;
        }
        
        .modal input {
            width: 100%;
            padding: 12px;
            border: 2px solid #667eea;
            border-radius: 10px;
            margin-bottom: 15px;
            font-size: 16px;
        }
        
        .modal-buttons {
            display: flex;
            justify-content: center;
            gap: 10px;
        }
        
        .winner-icon {
            font-size: 60px;
            margin-bottom: 15px;
        }
    </style>
</head>
<body>
        <div class="container">
            <h1>üí£ Êâ´Èõ∑Ê∏∏Êàè</h1>
            <p style="text-align:center;color:#666;font-size:12px;margin-bottom:10px;">üí° ÁÇπÂáªÊè≠ÂºÄÊ†ºÂ≠ê | ÈïøÊåâÊ†áËÆ∞Âú∞Èõ∑</p>
            
            <div class="difficulty-selector">
            <button class="difficulty-btn beginner active" data-difficulty="beginner">ÂàùÁ∫ß</button>
            <button class="difficulty-btn intermediate" data-difficulty="intermediate">‰∏≠Á∫ß</button>
            <button class="difficulty-btn advanced" data-difficulty="advanced">È´òÁ∫ß</button>
        </div>
        
        <div class="stats">
            <div class="stat-box">
                <div class="stat-label">‚è±Ô∏è Êó∂Èó¥</div>
                <div class="stat-value" id="timer">0</div>
            </div>
            <div class="stat-box">
                <div class="stat-label">üí£ Ââ©‰Ωô</div>
                <div class="stat-value" id="mines">10</div>
            </div>
        </div>
        
        <div class="buttons">
            <button class="btn btn-primary" id="newGameBtn">üéÆ Êñ∞Ê∏∏Êàè</button>
            <button class="btn btn-secondary" id="resetBtn">üîÑ ÈáçÁΩÆ</button>
        </div>
        
        <div class="board" id="board"></div>
        
        <div class="leaderboard">
            <h2>üèÜ ÊéíË°åÊ¶ú</h2>
            <ul class="leaderboard-list" id="leaderboardList">
                <li class="leaderboard-empty">ÊöÇÊó†ËÆ∞ÂΩïÔºåÂºÄÂßãÊ∏∏ÊàèÂêßÔºÅ</li>
            </ul>
        </div>
    </div>
    
    <div class="modal" id="winnerModal">
        <div class="modal-content">
            <div class="winner-icon">üéâ</div>
            <h2>ÊÅ≠Âñú‰Ω†Ëµ¢‰∫ÜÔºÅ</h2>
            <p id="winnerText">Áî®Êó∂: 0Áßí</p>
            <input type="text" id="playerName" placeholder="ËØ∑ËæìÂÖ•‰Ω†ÁöÑÂêçÂ≠ó" maxlength="15">
            <div class="modal-buttons">
                <button class="btn btn-primary" id="saveScoreBtn">üíæ ‰øùÂ≠òÂàÜÊï∞</button>
                <button class="btn btn-secondary" id="closeModalBtn">‚ùå ÂÖ≥Èó≠</button>
            </div>
        </div>
    </div>

    <script>
        const difficulties = {
            beginner: { rows: 9, cols: 9, mines: 10 },
            intermediate: { rows: 16, cols: 16, mines: 40 },
            advanced: { rows: 16, cols: 30, mines: 99 }
        };
        
        let currentDifficulty = 'beginner';
        let board = [];
        let revealed = [];
        let flagged = [];
        let gameOver = false;
        let gameStarted = false;
        let timer = 0;
        let timerInterval = null;
        let firstClick = true;
        
        function initGame() {
            const diff = difficulties[currentDifficulty];
            board = [];
            revealed = [];
            flagged = [];
            gameOver = false;
            gameStarted = false;
            firstClick = true;
            timer = 0;
            clearInterval(timerInterval);
            document.getElementById('timer').textContent = '0';
            document.getElementById('mines').textContent = diff.mines;
            document.getElementById('board').innerHTML = '';
            document.getElementById('board').style.gridTemplateColumns = `repeat(${diff.cols}, 30px)`;
            
            for (let i = 0; i < diff.rows; i++) {
                board[i] = [];
                revealed[i] = [];
                flagged[i] = [];
                for (let j = 0; j < diff.cols; j++) {
                    board[i][j] = 0;
                    revealed[i][j] = false;
                    flagged[i][j] = false;
                }
            }
            
            createBoardUI();
        }
        
        function createBoardUI() {
            const diff = difficulties[currentDifficulty];
            const boardEl = document.getElementById('board');
            
            for (let i = 0; i < diff.rows; i++) {
                for (let j = 0; j < diff.cols; j++) {
                    const cell = document.createElement('div');
                    cell.className = 'cell';
                    cell.dataset.row = i;
                    cell.dataset.col = j;
                    cell.addEventListener('click', () => handleClick(i, j));
                    
                    // Ëß¶Êë∏ÈïøÊåâÊ†áËÆ∞Âú∞Èõ∑ÔºàÊâãÊú∫Á´ØÔºâ
                    let longPressTimer = null;
                    cell.addEventListener('touchstart', (e) => {
                        if (gameOver || revealed[i][j]) return;
                        longPressTimer = setTimeout(() => {
                            toggleFlag(i, j);
                            navigator.vibrate(50);
                        }, 500);
                    }, { passive: true });
                    
                    cell.addEventListener('touchend', () => {
                        if (longPressTimer) {
                            clearTimeout(longPressTimer);
                            longPressTimer = null;
                        }
                    });
                    
                    cell.addEventListener('touchmove', () => {
                        if (longPressTimer) {
                            clearTimeout(longPressTimer);
                            longPressTimer = null;
                        }
                    });
                    
                    // Ê°åÈù¢Á´ØÂè≥ÈîÆÊ†áËÆ∞
                    cell.addEventListener('contextmenu', (e) => {
                        e.preventDefault();
                        toggleFlag(i, j);
                    });
                    boardEl.appendChild(cell);
                }
            }
        }
        
        function placeMines(excludeRow, excludeCol) {
            const diff = difficulties[currentDifficulty];
            let minesPlaced = 0;
            
            while (minesPlaced < diff.mines) {
                const row = Math.floor(Math.random() * diff.rows);
                const col = Math.floor(Math.random() * diff.cols);
                
                if (Math.abs(row - excludeRow) <= 1 && Math.abs(col - excludeCol) <= 1) continue;
                if (board[row][col] === -1) continue;
                
                board[row][col] = -1;
                minesPlaced++;
            }
            
            calculateNumbers();
        }
        
        function calculateNumbers() {
            const diff = difficulties[currentDifficulty];
            
            for (let i = 0; i < diff.rows; i++) {
                for (let j = 0; j < diff.cols; j++) {
                    if (board[i][j] === -1) continue;
                    
                    let count = 0;
                    for (let di = -1; di <= 1; di++) {
                        for (let dj = -1; dj <= 1; dj++) {
                            const ni = i + di;
                            const nj = j + dj;
                            if (ni >= 0 && ni < diff.rows && nj >= 0 && nj < diff.cols && board[ni][nj] === -1) {
                                count++;
                            }
                        }
                    }
                    board[i][j] = count;
                }
            }
        }
        
        function handleClick(row, col) {
            if (gameOver || flagged[row][col]) return;
            
            if (firstClick) {
                firstClick = false;
                placeMines(row, col);
                startTimer();
            }
            
            revealCell(row, col);
            checkWin();
        }
        
        function revealCell(row, col) {
            const diff = difficulties[currentDifficulty];
            
            if (row < 0 || row >= diff.rows || col < 0 || col >= diff.cols) return;
            if (revealed[row][col] || flagged[row][col]) return;
            
            revealed[row][col] = true;
            const cell = document.querySelector(`[data-row="${row}"][data-col="${col}"]`);
            cell.classList.add('revealed');
            
            if (board[row][col] === -1) {
                cell.classList.add('mine');
                cell.textContent = 'üí£';
                endGame(false);
                return;
            }
            
            if (board[row][col] > 0) {
                cell.textContent = board[row][col];
                cell.dataset.num = board[row][col];
            } else {
                for (let di = -1; di <= 1; di++) {
                    for (let dj = -1; dj <= 1; dj++) {
                        revealCell(row + di, col + dj);
                    }
                }
            }
        }
        
        function toggleFlag(row, col) {
            if (gameOver || revealed[row][col]) return;
            
            const diff = difficulties[currentDifficulty];
            const cell = document.querySelector(`[data-row="${row}"][data-col="${col}"]`);
            
            if (flagged[row][col]) {
                flagged[row][col] = false;
                cell.classList.remove('flagged');
                cell.textContent = '';
            } else {
                flagged[row][col] = true;
                cell.classList.add('flagged');
                cell.textContent = 'üö©';
            }
            
            let flagCount = 0;
            for (let i = 0; i < diff.rows; i++) {
                for (let j = 0; j < diff.cols; j++) {
                    if (flagged[i][j]) flagCount++;
                }
            }
            document.getElementById('mines').textContent = diff.mines - flagCount;
        }
        
        function startTimer() {
            gameStarted = true;
            timerInterval = setInterval(() => {
                timer++;
                document.getElementById('timer').textContent = timer;
            }, 1000);
        }
        
        function checkWin() {
            const diff = difficulties[currentDifficulty];
            let revealedCount = 0;
            
            for (let i = 0; i < diff.rows; i++) {
                for (let j = 0; j < diff.cols; j++) {
                    if (revealed[i][j]) revealedCount++;
                }
            }
            
            if (revealedCount === diff.rows * diff.cols - diff.mines) {
                endGame(true);
            }
        }
        
        function endGame(won) {
            gameOver = true;
            clearInterval(timerInterval);
            
            if (won) {
                document.getElementById('winnerText').textContent = `üéâ ÊÅ≠ÂñúÔºÅÁî®Êó∂: ${timer}Áßí`;
                document.getElementById('winnerModal').classList.add('active');
            } else {
                revealAllMines();
            }
        }
        
        function revealAllMines() {
            const diff = difficulties[currentDifficulty];
            
            for (let i = 0; i < diff.rows; i++) {
                for (let j = 0; j < diff.cols; j++) {
                    if (board[i][j] === -1) {
                        const cell = document.querySelector(`[data-row="${i}"][data-col="${j}"]`);
                        cell.classList.add('revealed', 'mine');
                        cell.textContent = 'üí£';
                    }
                }
            }
        }
        
        function saveScore() {
            const name = document.getElementById('playerName').value.trim() || 'ÂåøÂêçÁé©ÂÆ∂';
            const leaderboard = JSON.parse(localStorage.getItem('minesweeper_' + currentDifficulty) || '[]');
            
            leaderboard.push({ name, time: timer, date: new Date().toLocaleDateString() });
            leaderboard.sort((a, b) => a.time - b.time);
            leaderboard.splice(10);
            
            localStorage.setItem('minesweeper_' + currentDifficulty, JSON.stringify(leaderboard));
            document.getElementById('winnerModal').classList.remove('active');
            document.getElementById('playerName').value = '';
            displayLeaderboard();
        }
        
        function displayLeaderboard() {
            const leaderboard = JSON.parse(localStorage.getItem('minesweeper_' + currentDifficulty) || '[]');
            const listEl = document.getElementById('leaderboardList');
            
            if (leaderboard.length === 0) {
                listEl.innerHTML = '<li class="leaderboard-empty">ÊöÇÊó†ËÆ∞ÂΩïÔºåÂºÄÂßãÊ∏∏ÊàèÂêßÔºÅ</li>';
                return;
            }
            
            const difficultyNames = {
                beginner: 'ÂàùÁ∫ß',
                intermediate: '‰∏≠Á∫ß',
                advanced: 'È´òÁ∫ß'
            };
            
            let html = `<h3 style="text-align:center;margin-bottom:15px;color:#667eea;">${difficultyNames[currentDifficulty]}</h3>`;
            
            leaderboard.forEach((entry, index) => {
                let className = 'leaderboard-item';
                if (index === 0) className += ' gold';
                else if (index === 1) className += ' silver';
                else if (index === 2) className += ' bronze';
                
                html += `
                    <li class="${className}">
                        <span><span class="leaderboard-rank">${index + 1}.</span>${entry.name}</span>
                        <span class="leaderboard-time">‚è±Ô∏è ${entry.time}Áßí</span>
                    </li>
                `;
            });
            
            listEl.innerHTML = html;
        }
        
        document.querySelectorAll('.difficulty-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                document.querySelectorAll('.difficulty-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                currentDifficulty = btn.dataset.difficulty;
                displayLeaderboard();
                initGame();
            });
        });
        
        document.getElementById('newGameBtn').addEventListener('click', initGame);
        document.getElementById('resetBtn').addEventListener('click', initGame);
        document.getElementById('saveScoreBtn').addEventListener('click', saveScore);
        document.getElementById('closeModalBtn').addEventListener('click', () => {
            document.getElementById('winnerModal').classList.remove('active');
        });
        
        initGame();
        displayLeaderboard();
    </script>
</body>
</html>
